FROM node:14-alpine
ARG REACT_APP_ENDPOINT
ENV TYPEORM_CONNECTION 'postgres'
ARG TYPEORM_HOST
ARG TYPEORM_USERNAME
ARG TYPEORM_PASSWORD
ARG TYPEORM_DATABASE
ARG TYPEORM_PORT

ENV TYPEORM_HOST ${TYPEORM_HOST}
ENV TYPEORM_USERNAME ${TYPEORM_USERNAME}
ENV TYPEORM_PASSWORD ${TYPEORM_PASSWORD}
ENV TYPEORM_DATABASE ${TYPEORM_DATABASE}
ENV TYPEORM_PORT ${TYPEORM_PORT}
ENV TYPEORM_MIGRATIONS "migration/*.ts"
WORKDIR /app

COPY . ./
RUN npm install

EXPOSE 4000
CMD ["npm", "run", "docker"]